<div class="content-container" ng-app="myApp" ng-controller="MainCtrl">

  <div class="game-detail-wrapper">
    <div class="game-detail-section">
      <div class="game-detail-head"> 
        <div class="player-img">
        </div>
        <div class="title"><%= @game.title %></div>
        <div class="potential-img"></div>
      </div>

      <div class="game-detail-body">
        <div class="left">
          <div class="info">
            <div class:"info-details">Description:</div><br>
            <%= @game.description %><br>
            <% if @game.user_id != nil %>
              by: <%= @user_game.first_name %> <%= @user_game.last_name %><br>
              created on: <%= @game.created_at.strftime('%m/%d/%Y') %>
            <% else %>
              by: anonymous
            <% end %>
            <hr class="gd-hr">
          </div>
          <div class="score">
            <div class="score-title">Scores: </div><br>

            <% if @game.score != nil %>
              <div class="existing-scores" ng-hide="openScoreBox == true">
                <%= @game.score %>
              </div>
            <% end %>
            
            <table ng-show="scoreAdded == true" class="table responsive-table score-game">
              <thead>
                <th>Game Rounds</th>
                <th>Player 1</th>
                <th>Player 2</th>
              </thead>
              <tbody>
                <tr>
                  <td>First Game:</td>
                  <td>{{ score.player_1.first }}</td>
                  <td>{{ score.player_2.first }}</td>
                </tr>
                <tr>
                  <td>Second Game:</td>
                  <td>{{ score.player_1.second }}</td>
                  <td>{{ score.player_2.second }}</td>
                </tr>
                <tr>
                  <td>Third Game:</td>
                  <td>{{ score.player_1.third }}</td>
                  <td>{{ score.player_2.third }}</td>
                </tr>
                <tr>
                  <td>Total:</td>
                  <td>{{ score.player_1.total }}</td>
                  <td>{{ score.player_2.total }}</td>
                </tr>
                <tr>
                  <td>Winner:</td>
                  <td colspan="2">{{ score.winner }}</td>
                </tr>
              </tbody>
            </table> <!-- score-game -->
            <button ng-show="scoreAdded == true" ng-click="persistScore();" class="btn-success add-score">Save score to database</button>

            
            <button ng-click="openScoreBox = true;" ng-hide="openScoreBox == true" class="btn-success add-score">Add new score</button>
            <div class="score-form" ng-show="openScoreBox == true" style="margin-left: 20%">
            <form 
            name="scoreForm" ng-show="openScoreBox == true" ng-hide="scoreAdded == true" style="width: 100px; height: 100px; display: inline" novalidate>
              First: <br>
              <input type="integer" ng-model="score.player_1.first" placeholder="Player 1"></input> - <input type="integer" ng-model="score.player_2.first" placeholder="Player 2"></input> <br> 
              Second: <br>
              <input type="integer" placeholder="Player 1" ng-model="score.player_1.second"></input> - <input type="integer" placeholder="Player 2" ng-model="score.player_2.second"></input> <br>
              Third: <br>
              <input type="integer" placeholder="Player 1" ng-model="score.player_1.third"></input> - <input type="integer" placeholder="Player 2" ng-model="score.player_2.third"></input> <br>
              <button ng-click="addScore(); scoreAdded = true" ng-hide="scoreAdded == true" class="btn-success save-score">Save score</button>
            </form>
          </div> <!-- score-form -->
          </div> <!-- score -->
        </div> <!-- left -->
        <div class="middle">
          <div class="location-img">
            <div id="showmap"><div class="display-map" ng-click="initialize(<%= @coords %>); hideNow = true" ng-hide="hideNow == true">Display map</div></div>
          </div>
          <div class="suggested-locs">coordinates: <br>
           <%= @game.coordinates %><br>
          </div>
        </div>
        <div class="right">
          <div class="comms">
            <strong>Comments</strong>
            <% @game.comments.each do |comment| %>
              <p>
                <%= comment.body %> <br>
                <div class="commenter"> by: <%= comment.commenter %>, at: <%= comment.created_at.strftime('%m/%d/%Y') %> - 
                <a data-confirm="Are you sure?" data-method="delete" href="/games/<%= @game.id %>/comments/<%=comment.id%>" rel="nofollow">Delete</a> </div>
              </p>
            <% end %>
            <hr class="gd-hr">
          </div>
          <div class="new-comms ">
            <p>Let them know you want to play:</p>
            <%= form_for([@game, @game.comments.build]) do |f| %>
              <div class="field">
                <%= f.text_area :body %>
              </div>
              <span class="field">
                your name : <br>
                <%= f.text_field :commenter %>
              </span>
              <span class="actions">
                <button class="btn-success">Add</button>
              </span>
            <% end %>
          </div>
        </div>
      </div>
  </div>

  <div class="edit-back">
    <a href="#" ng-click="reloadRoute('/games/<%= @game.id %>/edit')">Edit</a> |
    <%= link_to 'Delete', @game, method: :delete, data: { confirm: 'Are you sure?' } %> |
    <a href="#" ng-click="reloadRoute('/games')">Back</a>
  </div>
</div>


<script>
  function initialize(coor) {
    var coords = [40.78694, -73.97528];
    console.log(coords);
    console.log('real coords are ', coor);
    var uluru = {lat: coords[0], lng: coords[1]};
    var map = new google.maps.Map(document.getElementById('showmap'), {
      // zoom: 4,
      zoom: 14,
      center: uluru
    });
    var marker = new google.maps.Marker({
      position: uluru,
      map: map
    });
  }
</script>